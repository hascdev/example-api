import UserModel from '../models/user.model.js';
import ProfileModel from '../models/profile.model.js';

class UserController {

    getProfile = async (req, res) => {

        try {

            const id = req.params.id;

            // Get profile from database
            const profile = await ProfileModel.findByUserId(id);
            console.log("profile", profile);

            if (!profile) {
                return res.status(404).json({ message: "Profile not found" });
            }

            // Send the profile back to the client
            res.json({ profile });

        } catch (error) {
            return res.status(500).json({ message: error.message });
        }
    }

    revoke = async (req, res) => {
        
        try {
            
            const id = req.params.id;

            const user = {
                id,
                hash: [...Array(30)].map((e) => ((Math.random() * 36) | 0).toString(36)).join('')
            }
            
            // All tokens generated by the previous hash will become invalid.
            await UserModel.findByIdAndUpdate(user);

            return res.status(200).json({ message: 'Token revoked successfully' });

        } catch (error) {
            return res.status(500).json({ message: error.message });
        }
    }
}

export default new UserController();